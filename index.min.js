export class BaseScene extends Phaser.Scene{constructor(e){super(e)}create(e){this.map=this.make.tilemap({key:e});const s=this.map.addTilesetImage("tileset","TilesetImage",32,32,1,2);this.map.createLayer("Ground1",s,0,0),this.map.createLayer("Ground2",s,0,0),this.map.createLayer("Collision1",s,0,0),this.map.createLayer("Collision2",s,0,0),this.map.createLayer("Above",s,0,0).setDepth(10),this.LayerToCollide=this.map.createLayer("CollisionLayer",s,0,0),this.LayerToCollide.setVisible(!1);const i=this.map.findObject("Objects",(e=>"Spawn Point"===e.name));this.player=this.add.player(i.x,i.y,"atlas","ariel-front");const t=this.cameras.main;t.startFollow(this.player),t.setBounds(0,0,this.map.widthInPixels,this.map.heightInPixels),this.cursors=this.input.keyboard.createCursorKeys(),this.wasd={w:this.input.keyboard.addKey("W"),a:this.input.keyboard.addKey("A"),s:this.input.keyboard.addKey("S"),d:this.input.keyboard.addKey("D")},this.scale.on("resize",this.resize,this),this.signs=[],this.showingSign=!1,this.map.filterObjects("Objects",(e=>{"door"===e.name?this.add.door(Math.round(e.x),Math.round(e.y),e.width,e.height,e.properties[0].value,e.properties[1].value):"bigSign"===e.name?this.bigSign=this.add.bigSign(Math.round(e.x),Math.round(e.y),e.width,e.height,e.properties[0].value,e.properties[1].value,e.properties[2].value,e.properties[3].value,e.properties[4].value):"sign"===e.name&&this.signs.push(this.add.sign(e.x,e.y,e.properties[1].value,e.properties[0].value))})),this.musicButton=this.add.musicButton(120,45,"mute","play"),this.sys.game.device.fullscreen.available&&(this.fullscreenButton=this.add.fullscreenButton(180,45,"fullscreen","fullscreen2"))}resize(e,s,i,t){this.cameras.resize(e.width,e.height)}collide_with_world(){this.physics.add.collider(this.player,this.LayerToCollide),this.LayerToCollide.setCollisionBetween(40,41),this.player.body.setCollideWorldBounds(!0),this.player.body.onWorldBounds=!0}update(e,s){let i=!1,t=!1,a=!1,r=!1,h=this.input.activePointer;if(h.primaryDown&&!window.mouseOverMenu){document.getElementById("game-menu").style.display="none";let e=this.cameras.main.getWorldPoint(h.x,h.y);Math.abs(e.x-this.player.x)>15&&(e.x>this.player.x?t=!0:e.x<this.player.x&&(i=!0)),Math.abs(e.y-this.player.y)>15&&(e.y>this.player.y?r=!0:e.y<this.player.y&&(a=!0))}this.cursors.left.isDown||this.wasd.a.isDown?i=!0:(this.cursors.right.isDown||this.wasd.d.isDown)&&(t=!0),this.cursors.up.isDown||this.wasd.w.isDown?a=!0:(this.cursors.down.isDown||this.wasd.s.isDown)&&(r=!0),this.player.update(i,t,a,r),this.showingSign&&(i||t||a||r)&&this.signs.forEach((e=>{e.activated&&e.playerMovement(i,t,a,r)})),this.bigSign.hideSignText(this.player)}}
export class OverworldScene extends BaseScene{constructor(){super("OverworldScene")}preload(){this.load.image("TilesetImage","./assets/prod/tilesets_and_maps/tileset_extruded.png"),this.load.tilemapTiledJSON("OverworldMap","./assets/prod/tilesets_and_maps/overworld-new.json"),this.load.atlas("atlas","./assets/prod/atlas/player.png","./assets/prod/atlas/player.json"),this.load.bitmapFont("pixelop","assets/prod/fonts/pixelop.png","assets/prod/fonts/pixelop.xml"),this.load.atlas("anims_ui","./assets/prod/atlas/anims_ui.png","./assets/prod/atlas/anims_ui.json")}create(){super.create("OverworldMap"),this.physics.world.setBounds(0,0,1920,1088),this.cameras.main.setBounds(0,0,1920,1088),this.events.on("wake",(()=>{this.player.setTexture("atlas","ariel-front")}),this),this.collide_with_world(),document.getElementById("loading").style.display="none"}}
export class ResearchScene extends BaseScene{constructor(){super("ResearchScene")}preload(){document.getElementById("loading").style.display="flex",this.load.tilemapTiledJSON("ResearchMap","./assets/prod/tilesets_and_maps/research-new.json")}create(){super.create("ResearchMap"),this.physics.world.setBounds(0,0,960,768),this.cameras.main.setBounds(0,0,960,768),this.events.on("create",(()=>{this.player.setTexture("atlas","ariel-back")}),this),this.events.on("wake",(()=>{this.player.setTexture("atlas","ariel-back")}),this),this.collide_with_world(),document.getElementById("loading").style.display="none"}}
export class SoftwareScene extends BaseScene{constructor(){super("SoftwareScene")}preload(){document.getElementById("loading").style.display="flex",this.load.tilemapTiledJSON("SoftwareMap","./assets/prod/tilesets_and_maps/software-new.json")}create(){super.create("SoftwareMap"),this.physics.world.setBounds(0,0,960,768),this.cameras.main.setBounds(0,0,960,768),this.events.on("create",(()=>{this.player.setTexture("atlas","ariel-back")}),this),this.events.on("wake",(()=>{this.player.setTexture("atlas","ariel-back")}),this),this.anims.create({key:"smallcomputer-anim",frames:this.anims.generateFrameNames("anims_ui",{prefix:"comput2.",start:0,end:1,zeroPad:3}),frameRate:2,repeat:-1});this.add.sprite(880,80,"anims_ui","comput2.000").play("smallcomputer-anim"),this.anims.create({key:"bigcomputer-anim",frames:this.anims.generateFrameNames("anims_ui",{prefix:"comput.",start:0,end:1,zeroPad:3}),frameRate:2,repeat:-1});this.add.sprite(528,80,"anims_ui","comput.000").play("bigcomputer-anim"),this.collide_with_world(),document.getElementById("loading").style.display="none"}}
export class UniversityScene extends BaseScene{constructor(){super("UniversityScene")}preload(){document.getElementById("loading").style.display="flex",this.load.tilemapTiledJSON("UniversityMap","./assets/prod/tilesets_and_maps/university-new.json")}create(){super.create("UniversityMap"),this.physics.world.setBounds(0,0,1440,768),this.cameras.main.setBounds(0,0,1440,768),this.events.on("create",(()=>{this.player.setTexture("atlas","ariel-back")}),this),this.events.on("wake",(()=>{this.player.setTexture("atlas","ariel-back")}),this),this.anims.create({key:"fountain-anim",frames:this.anims.generateFrameNames("anims_ui",{prefix:"fountain.",start:1,end:3,zeroPad:3}),frameRate:5,repeat:-1});this.add.sprite(928,608,"anims_ui","fountain.000").playReverse("fountain-anim"),this.collide_with_world(),document.getElementById("loading").style.display="none"}}
class UIButton extends Phaser.GameObjects.Image{constructor(t,e,s,i,n){super(t,e,s,"anims_ui",i),t.add.existing(this),this.setScrollFactor(0).setDepth(105),this.initialX=e,this.texture1=i,this.texture2=n,this.activated=!1;const u=this;this.setInitialTexture(u),t.events.on("wake",(()=>this.setInitialTexture(u))),this.setInteractive({useHandCursor:!0}).on("pointerdown",(()=>this.clickButton(u,t)))}clickButton(t,e){window.mouseOverMenu=!0,t.activated?t.deactivateButton(t,e):t.activateButton(t,e)}}export class FullscreenButton extends UIButton{constructor(t,e,s,i,n){super(t,e,s,i,n),t.scale.on("enterfullscreen",(()=>this.enterFullScreen(this))),t.scale.on("leavefullscreen",(()=>this.leaveFullScreen(this)))}setInitialTexture(t){t.scene.scale.isFullscreen?(t.setTexture("anims_ui",t.texture2),t.x=t.initialX-70,t.scene.musicButton.x=t.scene.musicButton.initialX-70):(t.setTexture("anims_ui",t.texture1),t.x=t.initialX,t.scene.musicButton.x=t.scene.musicButton.initialX)}activateButton(t,e){t.scene.scale.startFullscreen()}enterFullScreen(t){t.setTexture("anims_ui",t.texture2),t.x=t.initialX-70,t.scene.musicButton.x=t.scene.musicButton.initialX-70,t.activated=!0}deactivateButton(t,e){t.scene.scale.stopFullscreen()}leaveFullScreen(t){t.setTexture("anims_ui",t.texture1),t.x=t.initialX,t.scene.musicButton.x=t.scene.musicButton.initialX,t.activated=!1}}export class MusicButton extends UIButton{setInitialTexture(t){const e=t.scene.sound.get("music");null!==e&&e.isPlaying?t.setTexture("anims_ui",t.texture2):t.setTexture("anims_ui",t.texture1)}activateButton(t,e){if(!e.load.isLoading()){const s=e.sound.get("music");null!==s?(s.resume(),t.setTexture("anims_ui",t.texture2),t.activated=!0):(t.setTexture("anims_ui","dots"),e.load.audio("music","/assets/prod/audio/music.mp3"),e.load.once("complete",(function(){"suspended"===e.sound.context.state&&e.sound.context.resume(),e.sound.play("music",{volume:.65,loop:!0,delay:1}),t.setTexture("anims_ui",t.texture2),t.activated=!0})),e.load.start())}}deactivateButton(t,e){const s=e.sound.get("music");null!==s&&s.pause(),t.setTexture("anims_ui",t.texture1),t.activated=!1}}
export class BigSign extends Phaser.GameObjects.Zone{constructor(e,i,s,t,p,a,h,n,r,l){super(e,i,s,t,p),e.add.existing(this).setOrigin(0,1),e.physics.world.enable(this,1),e.physics.add.overlap(e.player,this,(()=>this.showSignText(e.player))),this.sm_signText=e.add.bitmapText(n,r,"pixelop",l,16,1).setOrigin(0,1).setDepth(101).setVisible(!1),this.sm_signRect=e.add.rectangle(n-10,r,this.sm_signText.width+20,this.sm_signText.height,16777215).setStrokeStyle(1,0).setOrigin(0,1).setDepth(100).setVisible(!1),this.signText=e.add.bitmapText(a,h,"pixelop",l,32,1).setOrigin(0,1).setDepth(101).setVisible(!1),this.signRect=e.add.rectangle(a-10,h,this.signText.width+20,this.signText.height,16777215).setStrokeStyle(1,0).setOrigin(0,1).setDepth(100).setVisible(!1),e.anims.create({key:"purple-tile-anim",frames:e.anims.generateFrameNames("anims_ui",{prefix:"purple.",start:0,end:2,zeroPad:3}),frameRate:6,yoyo:!0,delay:400,repeatDelay:800,repeat:-1}),this.purple_tiles=[],"ResearchScene"===e.scene.key?this.purple_tiles.push(e.add.sprite(i-30,s-10,"anims_ui","purple.000").setOrigin(0,1)):(this.purple_tiles.push(e.add.sprite(i-8,s,"anims_ui","purple.000").setOrigin(0,1)),p>32&&(this.purple_tiles.push(e.add.sprite(i-8,s-32,"anims_ui","purple.000").setOrigin(0,1)),this.purple_tiles.push(e.add.sprite(i-8+32,s,"anims_ui","purple.000").setOrigin(0,1)),this.purple_tiles.push(e.add.sprite(i-8+32,s-32,"anims_ui","purple.000").setOrigin(0,1)))),this.purple_tiles.forEach((e=>e.setDepth(2).play("purple-tile-anim",!0))),this.activated=!1}showSignText(e){Math.ceil(e.y+20)<=this.y&&(this.purple_tiles.forEach((e=>e.anims.stop().setTint(16776960))),this.activated=!0,window.innerWidth<900?(this.sm_signRect.setVisible(!0),this.sm_signText.setVisible(!0)):(this.signRect.setVisible(!0),this.signText.setVisible(!0)),"OverworldScene"===this.scene.scene.key&&0===e.body.velocity.x&&0===e.body.velocity.y&&e.anims.play("ariel-wave",!0))}hideSignText(e){this.activated&&(!e.body.embedded&&e.body.touching.none||Math.ceil(e.y+20)>this.y)&&(this.signRect.setVisible(!1),this.signText.setVisible(!1),this.sm_signRect.setVisible(!1),this.sm_signText.setVisible(!1),this.purple_tiles.forEach((e=>{e.clearTint()})),this.activated=!1)}}
export class Door extends Phaser.GameObjects.Zone{constructor(i,e,s,t,n,o,h){super(i,e,s,t,n),this.setOrigin(0,1),i.add.existing(this),i.physics.world.enable(this,1),this.destination=o,this.link=h,i.physics.add.collider(i.player,this,(()=>this.enterDoor(i)))}enterDoor(i){!i.player.body.touching.none&&i.player.body.wasTouching.none&&(this.link?window.location.href="./home#"+this.destination:i.scene.switch(this.destination))}}
Phaser.GameObjects.GameObjectFactory.register("sign",(function(e,t,r,n){return new Sign(this.scene,e,t,r,n)})),Phaser.GameObjects.GameObjectFactory.register("bigSign",(function(e,t,r,n,s,i,o,c,a){return new BigSign(this.scene,e,t,r,n,s,i,o,c,a)})),Phaser.GameObjects.GameObjectFactory.register("door",(function(e,t,r,n,s,i){return new Door(this.scene,e,t,r,n,s,i)})),Phaser.GameObjects.GameObjectFactory.register("player",(function(e,t,r,n){return new Player(this.scene,e,t,r,n)})),Phaser.GameObjects.GameObjectFactory.register("fullscreenButton",(function(e,t,r,n){return new FullscreenButton(this.scene,e,t,r,n)})),Phaser.GameObjects.GameObjectFactory.register("musicButton",(function(e,t,r,n){return new MusicButton(this.scene,e,t,r,n)}));
export class Player extends Phaser.GameObjects.Sprite{constructor(e,a,t,s,r){super(e,a,t,s,r),e.add.existing(this),e.physics.add.existing(this),this.setDepth(5),this.body.setSize(26,41),this.createAnims(e),this.speed=175}createAnims(e){const a=e.anims;a.create({key:"ariel-left-walk",frames:a.generateFrameNames("atlas",{prefix:"ariel-left-walk.",start:0,end:3,zeroPad:3}),frameRate:10,repeat:-1}),a.create({key:"ariel-right-walk",frames:a.generateFrameNames("atlas",{prefix:"ariel-right-walk.",start:0,end:3,zeroPad:3}),frameRate:10,repeat:-1}),a.create({key:"ariel-front-walk",frames:a.generateFrameNames("atlas",{prefix:"ariel-front-walk.",start:0,end:3,zeroPad:3}),frameRate:10,repeat:-1}),a.create({key:"ariel-back-walk",frames:a.generateFrameNames("atlas",{prefix:"ariel-back-walk.",start:0,end:3,zeroPad:3}),frameRate:10,repeat:-1}),a.create({key:"ariel-wave",frames:a.generateFrameNames("atlas",{prefix:"ariel-wave.",start:0,end:4,zeroPad:3}),frameRate:10,repeat:-1})}update(e,a,t,s){const r=this.body.velocity.clone();this.body.setVelocity(0),e?(this.body.setVelocityX(-this.speed),this.anims.play("ariel-left-walk",!0)):a&&(this.body.setVelocityX(this.speed),this.anims.play("ariel-right-walk",!0)),t?(this.body.setVelocityY(-this.speed),e||a||this.anims.play("ariel-back-walk",!0)):s&&(this.body.setVelocityY(this.speed),e||a||this.anims.play("ariel-front-walk",!0)),this.body.velocity.normalize().scale(this.speed),e||a||t||s||null==this.anims.currentAnim||"ariel-wave"===this.anims.currentAnim.key||(this.anims.stop(),r.x<0?this.setTexture("atlas","ariel-left"):r.x>0?this.setTexture("atlas","ariel-right"):r.y<0?this.setTexture("atlas","ariel-back"):r.y>0&&this.setTexture("atlas","ariel-front"))}}
export class Sign extends Phaser.GameObjects.Zone{constructor(i,t,e,s,h){let n,c;super(i,t,e,32,32),i.add.existing(this).setOrigin(0,1),i.physics.world.enable(this,1),this.direction=h,"up"===h?(n=17,c=-45):"down"===h?(n=17,c=24):"center"===h&&(n=17,c=0),this.signText=i.add.bitmapText(Math.round(t+n),Math.round(e+c),"pixelop",s,16,1).setOrigin(.5,1).setDepth(101).setVisible(!1),this.signRect=i.add.rectangle(Math.round(t+n),Math.round(e+c),this.signText.width+10,this.signText.height,16777215).setStrokeStyle(1,0).setOrigin(.5,1).setDepth(100).setVisible(!1),i.physics.add.collider(i.player,this,(()=>this.collideSign(i.player))),this.setInteractive().on("pointerdown",this.clickSign),this.clickRadius=100,this.showByClick=!1,this.activated=!1}collideSign(i){this.activated||("center"===this.direction||"up"===this.direction&&i.body.touching.up||"down"===this.direction&&i.body.touching.down)&&this.showSignText()}clickSign(){if(!this.activated){Phaser.Math.Distance.BetweenPoints(this.getCenter(),this.scene.player)<this.clickRadius&&("UniversityScene"===this.scene.scene.key&&this.scene.signs.forEach((i=>i.hideSignText())),this.showSignText(),this.showByClick=!0)}}showSignText(){this.signRect.setVisible(!0),this.signText.setVisible(!0),this.scene.showingSign=!0,this.activated=!0}playerMovement(i,t,e,s){this.showByClick?Phaser.Math.Distance.BetweenPoints(this.getCenter(),this.scene.player)>this.clickRadius&&this.hideSignText():i||t||"up"===this.direction&&s?this.hideSignText():"down"!==this.direction&&"center"!==this.direction||s||this.hideSignText()}hideSignText(){this.signRect.setVisible(!1),this.signText.setVisible(!1),this.showByClick=!1,this.scene.showingSign=!1,this.activated=!1}}
const config={type:Phaser.AUTO,parent:"game-container",pixelArt:!0,autoRound:!0,autoFocus:!0,scale:{mode:Phaser.Scale.NONE,autoCenter:Phaser.Scale.NO_CENTER,width:getWidth(),height:getHeight(),zoom:resizeDPR()?Math.floor(window.devicePixelRatio)/window.devicePixelRatio:1},physics:{default:"arcade",arcade:{debug:!1,gravity:{y:0}}},scene:[OverworldScene,ResearchScene,UniversityScene,SoftwareScene]},game=new Phaser.Game(config);function mobileOrTablet(){let e=!1;var i;return i=navigator.userAgent||navigator.vendor||window.opera,(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(i)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(i.substr(0,4)))&&(e=!0),e}function resizeDPR(){return!Number.isInteger(window.devicePixelRatio)&&(!mobileOrTablet()&&1<window.devicePixelRatio&&window.devicePixelRatio<2)}function getWidth(){return resizeDPR()?window.innerWidth*window.devicePixelRatio:window.innerWidth}function getHeight(){return resizeDPR()?window.innerHeight*window.devicePixelRatio:window.innerHeight}window.addEventListener("resize",(function(e){game.scale.resize(getWidth(),getHeight())}),!1);let pic_circ=document.getElementById("pic-circ"),menu=document.getElementById("game-menu");window.mouseOverMenu=!1,document.addEventListener("pointerdown",(e=>{"pic-circ"===e.target.id||"game-menu"===e.target.id||"game-menu-link"===e.target.className?window.mouseOverMenu=!0:(window.mouseOverMenu=!1,pic_circ.style.transform="scale(1)")})),pic_circ.addEventListener("click",(()=>{"none"===menu.style.display?(menu.style.display="block",mobileOrTablet()&&(pic_circ.style.transform="scale(1.1)")):(menu.style.display="none",mobileOrTablet()&&(pic_circ.style.transform="scale(1)"))}));